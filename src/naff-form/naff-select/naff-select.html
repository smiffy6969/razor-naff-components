<!--
* razor-naff-components
* naff-select - Form select with feedback for multi selected items
* @author Paul Smith (smiffy6969)
* @site ulsmith.net
* @licence MIT
-->

<!-- STYLE - Encapsulate all css to tag name -->
<style>
	naff-select select { padding: 2px 5px; border: none; border-bottom: 2px solid #999; outline: none; font-size: 15px; background: transparent; }
	naff-select select:focus:not([disabled]), naff-select select:active:not([disabled]) { border-bottom-width: 3px; border-color: #777; }
	naff-select select[disabled] { cursor: not-allowed; border-bottom: 2px dashed #999; background-color: #fff; }
</style>

<!-- TEMPLATE -->
<template id="naff-select">
	<select naff-value="value" naff-on-change="changed()" naff-disabled="private.disabled">
		<option placeholder naff-text="private.placeholder" naff-if="private.placeholder" disabled></option>
		<option deselector naff-if="private.deselector" value=""></option>
		<option naff-each-option="attributes.options" naff-value="option | key private.attId">{{option | key private.attLabel}}</option>
	</select>
</template>

<!-- LOGIC -->
<script>
	// build scope
	naff.registerElement({
		name: 'naff-select',
		dataBind: true,

		// public properties
		value: null,

		// private properties
		private: {
			attId: null,
			attLabel: null,
			placeholder: null,
			deselector: false,
			disabled: false
		},

		created: function()
		{
			if (this.host.hasAttribute('options'))
			{
				try {
					var options = JSON.parse(this.host.getAttribute('options'));
					if (!this.attributes) this.attributes = {};
					if (!this.attributes.options) this.attributes.options = options;
				} catch (e) {}
			}
		},

		attached: function()
		{
			if (this.host.hasAttribute('option-id')) this.private.attId = this.host.getAttribute('option-id');
			if (this.host.hasAttribute('option-label')) this.private.attLabel = this.host.getAttribute('option-label');
			if (this.host.hasAttribute('deselector')) this.private.deselector = true;
			if (this.host.hasAttribute('disabled')) this.private.disabled = true;
			if (this.host.hasAttribute('placeholder'))
			{
				this.private.placeholder = this.host.getAttribute('placeholder');
				this.host.querySelector('option[placeholder]').setAttribute("selected", "");
			}
			if (this.host.value) this.value = this.host.value;
		},

		attributeChanged: function(name, oldVal, newVal)
		{
			switch (name)
			{
				case 'value':
					this.host.value = this.value = newVal;
				break;
				case 'options':
					try { this.attributes.options = JSON.parse(newVal); } catch (e) {}
				break;
				case 'option-id':
					this.private.attId = newVal;
				break;
				case 'option-label':
					this.private.attLabel = newVal;
				break;
				case 'placeholder':
					this.private.placeholder = newVal;
				break;
				case 'deselector':
					if (this.host.hasAttribute('deselector')) this.private.deselector = true;
					else this.private.deselector = false;
				break;
				case 'disabled':
					if (this.host.hasAttribute('disabled')) this.private.disabled = true;
					else this.private.disabled = false;
				break;
			}
		},

		changed: function()
		{
			this.host.value = this.value;
			this.host.setAttribute('value', this.value);
			this.fire('change');
		}
	});
</script>
