<!--
* razor-naff-components
* naff-switch - Toggle switch
* @author Paul Smith (smiffy6969)
* @site ulsmith.net
* @licence MIT
-->

<!-- DEPENDANCIES -->
<link rel="import" href="../../naff-base.html">

<!-- STYLE - Encapsulate all css to tag name -->
<style>
	naff-switch[disabled] naff-icon { opacity: 0.5; cursor: not-allowed;}
	naff-switch naff-icon { font-size: 30px; line-height: 30px; cursor: pointer; }
	naff-switch naff-icon[name='toggle-on'] { color: green; }
</style>

<!-- TEMPLATE --> 
<template id="naff-switch">
	<naff-icon></naff-icon>
</template>

<!-- LOGIC -->
<script>
	// build scope
	naff.registerElement({
		name: 'naff-switch',

		properties: { 
			disabled: false 
		},

		created: function()
		{			
			// Initial setup
			if (this.host.hasAttribute('disabled')) this.properties.disabled = true;
			if (this.host.hasAttribute('value')) this.host.value = this.host.getAttribute('value');
			this.setSwitch();
			
			var scope = this;
			Object.observe(this.host, function(changes)
			{
				for (var i = 0; i < changes.length; i++) 
				{
					if (changes[i].name != 'value') continue; 
					scope.setSwitch();
				}
			});	
		},

		attached: function()
		{
			this.template.querySelector('naff-icon').addEventListener('click', this.click);
		},

		detached: function()
		{
			this.template.querySelector('naff-icon').removeEventListener('click', this.click);
		},

		attributeChanged: function(name, oldVal, newVal)
		{
			if (name == 'disabled') this.properties.disabled = !newValue ? false: true;
			if (name =='value' && newVal != this.host.value) this.host.value = newVal == 1 ? 1 : 0;
		},

		click: function()
		{
			var scope = naff.getScope(this);
			if (scope.properties.disabled) return;
			scope.host.value = scope.host.value == 1 ? 0 : 1;
			scope.host.setAttribute('value', scope.host.value);
		},

		setSwitch: function()
		{
			this.template.querySelector('naff-icon').setAttribute('name', 'toggle-' + (this.host.value == 1 ? 'on' : 'off'));
			this.host.setAttribute('value', this.host.value);
			this.fire('change');
		}
	});
</script>